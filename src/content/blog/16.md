---
author: Code_You
pubDatetime: 2022-06-30T11:22
title: Vueä¸­çš„Web Components
postSlug: p16
featured: true
draft: false
tags:
  - Vue
  - Vue3
ogImage: ""
description: Vue3ä¸Web Componentsçš„çˆ±æ¨æƒ…ä»‡
---

> å…³äº [`Web Components`](https://developer.mozilla.org/zh-CN/docs/Web/Web_Components)
> å…³äº `Vue3.2`[`definecustomelement`](https://staging-cn.vuejs.org/api/general.html#definecustomelement)Api
> å…³äº [`Vue & Web Component`](https://staging-cn.vuejs.org/guide/extras/web-components.html)

### åœ¨`Vue3.2`ä¸­å®ç°ä¸€ä¸ª`dialog`

#### 1. ä¿®æ”¹`vite.config.ts`

```typescript
import { defineConfig } from "vite";
import vue from "@vitejs/plugin-vue";

// web components çš„ tag name
const webComponents = ["my-dialog"];

export default defineConfig({
  plugins: [
    vue({
      template: {
        compilerOptions: {
          // å‘ŠçŸ¥ vite è¿™äº› tag æ˜¯ è‡ªå®šä¹‰å…ƒç´ ï¼Œä¸ä»¥ vue components æ¥è§£æ
          isCustomElement: tag => webComponents.includes(tag),
        },
      },
    }),
  ],
});
```

#### 2. æ–°å»º`src/web-components`æ–‡ä»¶å¤¹

##### \_1. æ–°å»º `index.ce.vue`

> ###### å…³äº`.ce.vue`:
>
> `defineCustomElement` æ­é… `Vue` å•æ–‡ä»¶ç»„ä»¶ (`SFC`) ä½¿ç”¨æ—¶ï¼Œ`SFC` ä¸­çš„ `<style>` åœ¨ç”Ÿäº§ç¯å¢ƒæ„å»ºæ—¶ä»ç„¶ä¼šè¢«æŠ½å–å’Œåˆå¹¶åˆ°ä¸€ä¸ªå•ç‹¬çš„ `CSS` æ–‡ä»¶ä¸­ã€‚å½“æ­£åœ¨ä½¿ç”¨ `SFC` ç¼–å†™è‡ªå®šä¹‰å…ƒç´ æ—¶ï¼Œé€šå¸¸éœ€è¦æ”¹ä¸ºæ³¨å…¥ `<style>` æ ‡ç­¾åˆ°è‡ªå®šä¹‰å…ƒç´ çš„ `shadow root` ä¸Šã€‚
> å®˜æ–¹çš„ `SFC` å·¥å…·é“¾æ”¯æŒä»¥â€œè‡ªå®šä¹‰å…ƒç´ æ¨¡å¼â€å¯¼å…¥ `SFC` (éœ€è¦ `@vitejs/plugin-vue@^1.4.0`(`vite`ä¸­) æˆ– `vue-loader@^16.5.0`(`webpack(vue-cli)`ä¸­) )ã€‚ä¸€ä¸ªä»¥è‡ªå®šä¹‰å…ƒç´ æ¨¡å¼åŠ è½½çš„ `SFC` å°†ä¼šå†…è”å…¶ `<style>` æ ‡ç­¾ä¸º `CSS` å­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶æš´éœ²ä¸ºç»„ä»¶çš„ `styles` é€‰é¡¹ã€‚è¿™ä¼šè¢« `defineCustomElement` æå–ä½¿ç”¨ï¼Œå¹¶åœ¨åˆå§‹åŒ–æ—¶æ³¨å…¥åˆ°å…ƒç´ çš„ `shadow root` ä¸Šã€‚
> è¦å¼€å¯è¿™ä¸ªæ¨¡å¼ï¼Œåªéœ€è¦å°†ä½ çš„ç»„ä»¶æ–‡ä»¶ä»¥ `.ce.vue` ç»“å°¾å³å¯ï¼

```vue
<script setup lang="ts">
defineProps<{
  open: boolean | null;
}>();

const emits = defineEmits<{
  (e: "update:open", show: boolean): void;
}>();

const hide = () => {
  emits("update:open", false);
};
</script>

<template>
  <dialog :open="open">
    <slot>hello</slot>
    <button @click="hide">confirm</button>
  </dialog>
</template>

<style>
:host(:not([open])) {
  display: none;
}
:host {
  position: fixed;
  left: 0;
  top: 0;
  height: 100%;
  width: 100%;
  background-color: rgba(25, 28, 34, 0.88);
  z-index: 19;
  display: grid;
  place-items: center;
}
:host dialog {
  position: static;
  display: inherit;
}
</style>
```

##### \_2. æ–°å»º `index.ts`

```typescript
import { defineCustomElement } from "vue";
import MyDialog from "./index.ce.vue";

const registerMyDialog = () => {
  customElements.define("my-dialog", defineCustomElement(MyDialog));
};

export default registerMyDialog;
```

#### 3. åœ¨ `main.ts`ä¸­æ³¨å†Œ

```typescript
import { createApp } from "vue";
import App from "./App.vue";
import registerMyDialog from "./web-components/MyDialog";

registerMyDialog();

const app = createApp(App);
app.mount("#app");
```

#### 4. ä½¿ç”¨ `App.vue`ä¸ºä¾‹

```vue
<script setup lang="ts">
import { onMounted, onUnmounted, ref } from "vue";

const show = ref(false);
const dialogRef = ref<HTMLElement | null>(null);

const handleUpdateShow = (e: Event) => {
  const [_show] = <[boolean]>(<CustomEvent>e).detail;
  show.value = _show;
};

onMounted(() => {
  dialogRef.value?.addEventListener("update:open", handleUpdateShow);
});

onUnmounted(() => {
  dialogRef.value?.removeEventListener("update:open", handleUpdateShow);
});
</script>

<template>
  <div id="app">
    <button @click="show = true">show dialog</button>
    <my-dialog ref="dialogRef" .open="show">
      <h1>wo cao nb</h1>
    </my-dialog>
  </div>
</template>
```

> ###### å…³äº `props`
>
> å½“æˆ‘ä»¬ä¸º`web components`ä¼ é€’å‚æ•°æ—¶ï¼Œ`Vue 3` å°†é€šè¿‡ `in` æ“ä½œç¬¦è‡ªåŠ¨æ£€æŸ¥è¯¥å±æ€§æ˜¯å¦å·²ç»å­˜åœ¨äº `DOM` å¯¹è±¡ä¸Šï¼Œå¹¶ä¸”åœ¨è¿™ä¸ª `key` å­˜åœ¨æ—¶ï¼Œæ›´å€¾å‘äºå°†å€¼è®¾ç½®ä¸ºä¸€ä¸ª `DOM` å¯¹è±¡çš„å±æ€§ã€‚
> å› ä¸ºç”±äº `DOM attribute` åªèƒ½ä¸ºå­—ç¬¦ä¸²å€¼ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬éœ€è¦ä¸º`web components`ä¼ é€’å¤æ‚æ•°æ®æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ `DOM` å¯¹è±¡çš„å±æ€§æ¥ä¼ é€’æ•°æ®ï¼š
> å³ï¼šé€šè¿‡ `.prop` ä¿®é¥°ç¬¦æ¥è®¾ç½®è¯¥ `DOM`(`web cpmponents`) å¯¹è±¡çš„å±æ€§

```html
<my-element :user.prop="{ name: 'jack' }"></my-element>

<!-- ç­‰ä»·ç®€å†™ -->
<my-element .user="{ name: 'jack' }"></my-element>
```

> ###### å…³äº `web components`çš„`emits`äº‹ä»¶çš„æ¥æ”¶
>
> é€šè¿‡ `this.$emit` æˆ–è€… `setup` ä¸­çš„ `emit` è§¦å‘çš„äº‹ä»¶éƒ½ä¼šé€šè¿‡ä»¥ `CustomEvents` çš„å½¢å¼ä»è‡ªå®šä¹‰å…ƒç´ ä¸Šæ´¾å‘ã€‚é¢å¤–çš„äº‹ä»¶å‚æ•° (`payload`) å°†ä¼šè¢«æš´éœ²ä¸º `CustomEvent` å¯¹è±¡ä¸Šçš„ä¸€ä¸ª `detail` æ•°ç»„ã€‚
> åœ¨çˆ¶ç»„ä»¶ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡`ref`è·å–åˆ°å½“å‰çš„`web components`ï¼Œå†é€šè¿‡ä¾¦å¬å™¨`addEventListener`æ¥æ•è·æ¥è‡ª` web components``Vue SFC `çš„`emit`äº‹ä»¶ï¼Œå¹¶å¯ä»¥æ¥å—å…¶`CustomEvent`å¸¦æ¥çš„`emit payload`

#### 5. æ•ˆæœ

![image](/assets/images/16/1.png)

#### 6. åæ§½

**æœ‰ 1 è¯´ 1ï¼Œç”¨èµ·æ¥ä¸æ–¹ä¾¿ï¼Œå°¤å…¶æ˜¯å­ä¼ çˆ¶ ğŸ¤¢ğŸ¤¢ğŸ¤¢ğŸ¤¢ğŸ¤¢**
