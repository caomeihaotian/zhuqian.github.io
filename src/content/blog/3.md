---
author: Code_You
pubDatetime: 2020-12-11T10:02
title: è®©ä½ çš„ç½‘é¡µå›¾æ ‡åŠ¨èµ·æ¥
postSlug: p3
featured: true
draft: false
tags:
  - JavaScript
ogImage: ""
description: ç½‘é¡µå›¾æ ‡å˜æˆè§†é¢‘å›¾æ ‡ ğŸ¤©
---

# çœ‹ä¸‹å›¾ï¼Œä»”ç»†çœ‹ â†“

![](/assets/images/3/1.gif)

```javascript
class VideoIcon {
  constructor(videoPath, iconSize = 32) {
    this.videoPath = videoPath;
    this.iconSize = iconSize;
    this.iconLink = null;
    this.video = null;
    this.canvas = null;
  }

  initVideo() {
    const video = document.createElement("video");
    video.crossOrigin = "anonymous";
    video.controls = true;
    video.src = this.videoPath;
    video.width = 0;
    video.autoplay = true;
    video.style.display = "none";
    this.video = video;
    document.body.appendChild(video);
  }

  bindVideoEvent() {
    const { video } = this;
    video.addEventListener("timeupdate", e => {
      this.videoToImage();
    });
  }

  initCanvas() {
    const canvas = document.createElement("canvas");
    canvas.width = this.iconSize;
    canvas.height = this.iconSize;
    this.canvas = canvas;
  }

  videoToImage() {
    const context = this.canvas.getContext("2d");
    const { iconSize, video } = this;
    context.clearRect(0, 0, iconSize, iconSize);
    context.drawImage(video, 0, 0, iconSize, iconSize);
    this.setFaviconIcon();
  }

  setFaviconIcon() {
    const url = this.canvas.toDataURL();
    this.iconLink.href = url;
  }

  getLinkIconTag() {
    const head = document.querySelector("head");
    const links = Array.from(head.querySelectorAll("link"));
    const [iconTag] = links.filter(item => item.rel === "icon");
    if (iconTag) {
      this.iconLink = iconTag;
    } else {
      const link = document.createElement("link");
      link.rel = "icon";
      this.iconLink = link;
      document.head.appendChild(link);
    }
  }

  init() {
    this.getLinkIconTag();
    this.initVideo();
    this.initCanvas();
    this.bindVideoEvent();
  }
}
```

### Usage

#### å¯ä»¥å°†ä¸Šé¢çš„ä»£ç å­˜å…¥äº‘ç«¯ï¼Œç„¶åä¸º chrmoe æ–°å»ºä¸€ä¸ªä¹¦ç­¾ï¼Œå°†ä¹¦ç­¾çš„ç½‘å€æ”¹ä¸ºä»¥ä¸‹ï¼š

![](/assets/images/3/2.png)

![](/assets/images/3/3.png)

```javascript
javascript: (function () {
  const script = document.createElement("script");
  script.id = "vIcon";
  script.src = "https://cdn.jiajiwei.top/js/iconVideo.js";
  if (document.querySelector("#vIcon")) {
    script = null;
    return null;
  }
  document.body.appendChild(script);
  script.onload = function () {
    const v = new VideoIcon(
      "https://cdn.jiajiwei.top/video/watermelon.mp4"
    ).init();
  };
})();
```

#### ç„¶åæˆ‘ä»¬æ‰“å¼€ http ç½‘ç«™çš„é¡µé¢ç‚¹å‡»æˆ‘ä»¬è®¾ç½®å¥½çš„ä¹¦ç­¾ï¼Œå›¾æ ‡å°±å¼€å§‹æ’­æ”¾è§†é¢‘å•¦

![](/assets/images/3/4.png)
